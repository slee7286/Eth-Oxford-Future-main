"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[145],{3998:(e,t,n)=>{n.d(t,{$:()=>d});var i=n(5155),r=n(2115),a=n(2467),s=n(3101),o=n(4269);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:n,variant:r,size:s,asChild:d=!1,...u}=e,c=d?a.DX:"button";return(0,i.jsx)(c,{className:(0,o.cn)(l({variant:r,size:s,className:n})),ref:t,...u})});d.displayName="Button"},4269:(e,t,n)=>{n.d(t,{cn:()=>a});var i=n(2821),r=n(5889);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.QP)((0,i.$)(t))}},4730:(e,t,n)=>{n.d(t,{Q:()=>d,v:()=>l});var i=n(2115),r=n(1012),a=n(6836),s=n(8678),o=n(6830);function l(){let[e,t]=(0,i.useState)(null),[n,a]=(0,i.useState)(null),[s,l]=(0,i.useState)(null),d=(0,i.useCallback)(async()=>{if(!window.ethereum)return void alert("Please install MetaMask to use this application.");try{let e=new r.k(window.ethereum);await e.send("eth_requestAccounts",[]);let n=await e.getNetwork();if(Number(n.chainId)!==o.P.CHAIN_ID){try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x"+o.P.CHAIN_ID.toString(16)}]})}catch(e){4902===e.code&&await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x"+o.P.CHAIN_ID.toString(16),chainName:"Flare Coston2 Testnet",nativeCurrency:{name:"Coston2 Flare",symbol:"C2FLR",decimals:18},rpcUrls:[o.P.RPC_URL],blockExplorerUrls:[o.P.EXPLORER_URL]}]})}let e=new r.k(window.ethereum),n=await e.send("eth_requestAccounts",[]),i=await e.getNetwork();t(n[0]),a(e),l(Number(i.chainId))}else{let i=await e.send("eth_requestAccounts",[]);t(i[0]),a(e),l(Number(n.chainId))}}catch(e){console.error("Wallet connection failed",e)}},[]);return(0,i.useEffect)(()=>{if(window.ethereum){let e=e=>t(e[0]||null),n=()=>window.location.reload();return window.ethereum.on("accountsChanged",e),window.ethereum.on("chainChanged",n),window.ethereum.request({method:"eth_accounts"}).then(e=>{e.length>0&&d()}).catch(()=>{}),()=>{window.ethereum.removeListener("accountsChanged",e),window.ethereum.removeListener("chainChanged",n)}}},[d]),{address:e,provider:n,chainId:s,connect:d}}function d(e){let[t,n]=(0,i.useState)(null),[r,l]=(0,i.useState)(null),[d,u]=(0,i.useState)(null),[c,m]=(0,i.useState)(0n),[p,x]=(0,i.useState)([]),[f,g]=(0,i.useState)(!0),[h,v]=(0,i.useState)(null),w=(0,i.useRef)(0),b=(0,i.useCallback)(async()=>{try{let i=new a.FR(o.P.RPC_URL),r=new s.NZ(o.P.CONTRACT_ADDRESS,o.p,i),[d,c]=await Promise.allSettled([r.getContractState(),r.getCurrentGasPrice()]);if("fulfilled"===d.status&&d.value){let e=d.value;n({strikePriceGwei:BigInt(e[0]),expiryTimestamp:BigInt(e[1]),isSettled:e[2],settlementPriceGwei:BigInt(e[3]),totalLiquidityWei:BigInt(e[4]),participantCount:BigInt(e[5])}),v(null)}else if("rejected"===d.status){var t;console.warn("getContractState failed:",null==(t=d.reason)?void 0:t.message),v("Contract not responding. Check if correct address is deployed.")}if("fulfilled"===c.status&&c.value){let e=BigInt(c.value[0]);l({price:e>1000000000n?e/1000000000n:e,timestamp:BigInt(c.value[1])})}try{let e=await i.getBlockNumber();0===w.current&&(w.current=Math.max(0,e-5e3));let t=r.filters.FuturesMinted(),n=await r.queryFilter(t,w.current,e);if(n.length>0){let t=await Promise.all(n.slice(-20).map(async e=>{let t=await e.getBlock();return{trader:e.args[0],isLong:e.args[1],quantity:BigInt(e.args[2]),collateral:BigInt(e.args[3]),leverage:BigInt(e.args[4]),timestamp:t.timestamp,txHash:e.transactionHash}}));x(e=>[...t,...e].filter((e,t,n)=>n.findIndex(t=>t.txHash===e.txHash)===t).sort((e,t)=>t.timestamp-e.timestamp).slice(0,50)),w.current=e}}catch(e){console.warn("Event fetch failed (non-critical):",e)}if(e){let[t,n]=await Promise.allSettled([r.getPosition(e),r.liquidityProvided(e)]);if("fulfilled"===t.status&&t.value){let e=t.value;u({exists:e[0],isLong:e[1],quantity:BigInt(e[2]),collateralWei:BigInt(e[3]),leverage:BigInt(e[4]),marginMode:Number(e[5]),entryType:Number(e[6]),entryPrice:BigInt(e[7]),openTimestamp:BigInt(e[8]),isActive:e[9],isClaimed:e[10],notionalValue:BigInt(e[11]),margin:BigInt(e[12])})}"fulfilled"===n.status&&m(BigInt(n.value))}}catch(e){console.warn("Contract fetch error:",null==e?void 0:e.message),v((null==e?void 0:e.message)||"Failed to connect to contract")}finally{g(!1)}},[e]);return(0,i.useEffect)(()=>{b();let e=setInterval(b,o.P.POLL_INTERVAL_MS);return()=>clearInterval(e)},[b]),{contractState:t,currentGasPrice:r,userPosition:d,userLiquidity:c,recentTrades:p,loading:f,connectionError:h,refresh:b}}},5894:(e,t,n)=>{n.d(t,{dj:()=>c});var i=n(2115);let r=0,a=new Map,s=e=>{if(a.has(e))return;let t=setTimeout(()=>{a.delete(e),d({type:"REMOVE_TOAST",toastId:e})},5e3);a.set(e,t)},o=[],l={toasts:[]};function d(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?s(n):e.toasts.forEach(e=>s(e.id)),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),o.forEach(e=>e(l))}function u(e){let{...t}=e,n=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),i=()=>d({type:"DISMISS_TOAST",toastId:n});return d({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||i()}}}),{id:n,dismiss:i,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function c(){let[e,t]=i.useState(l);return i.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},6767:(e,t,n)=>{n.d(t,{Bc:()=>o,ZI:()=>u,k$:()=>d,m_:()=>l});var i=n(5155),r=n(2115),a=n(2288),s=n(4269);let o=a.Kq,l=a.bL,d=a.l9,u=r.forwardRef((e,t)=>{let{className:n,sideOffset:r=4,...o}=e;return(0,i.jsx)(a.UC,{ref:t,sideOffset:r,className:(0,s.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o})});u.displayName=a.UC.displayName},6830:(e,t,n)=>{n.d(t,{P:()=>i,p:()=>r});let i={CONTRACT_ADDRESS:"0x973Ca902b10Bb229cB8d90F79E451F1B16aa82B4",CHAIN_ID:114,RPC_URL:"https://coston2-api.flare.network/ext/C/rpc",POLL_INTERVAL_MS:5e3,EXPLORER_URL:"https://coston2-explorer.flare.network"},r=["function getContractState() view returns (uint256 strikePrice, uint256 expiryTimestamp, bool isSettled, uint256 settlementPrice, uint256 totalLiquidity, uint256 participantCount)","function getCurrentGasPrice() view returns (uint256 price, uint256 timestamp)","function getPosition(address _trader) view returns (bool exists, bool isLong, uint256 quantity, uint256 collateral, uint256 leverage, uint8 marginMode, uint8 entryType, uint256 entryPrice, uint256 openTimestamp, bool isActive, bool isClaimed, uint256 notionalValue, uint256 margin)","function calculatePayout(address _trader) view returns (uint256)","function getUserProfile(address _user) view returns (bool registered, string username, string metadataURI, uint256 totalTrades, uint256 registeredAt)","function getMarketInfo() view returns (string name, string description, uint256 strike, uint256 expiry, bool settled, uint256 participants)","function getActiveTraders() view returns (uint256)","function login() view returns (bool)","function liquidityProvided(address) view returns (uint256)","function strikePrice() view returns (uint256)","function expiryTimestamp() view returns (uint256)","function isSettled() view returns (bool)","function settlementPrice() view returns (uint256)","function totalLiquidity() view returns (uint256)","function participantCount() view returns (uint256)","function marketName() view returns (string)","function marketDescription() view returns (string)","function owner() view returns (address)","function registerUser(string _username, string _metadataURI) external","function mintLong(uint256 _quantity, uint256 _leverage, uint8 _marginMode) payable","function mintShort(uint256 _quantity, uint256 _leverage, uint8 _marginMode) payable","function addLiquidity() payable","function removeLiquidity(uint256 _amount)","function settleContract()","function claimPayout()","event FuturesMinted(address indexed trader, bool isLong, uint256 quantity, uint256 collateral, uint256 leverage, uint8 marginMode, uint8 entryType, uint256 entryPrice, uint256 notionalValue, uint256 margin, uint256 timestamp)","event UserRegistered(address indexed user, string username)","event UserLoggedIn(address indexed user, uint256 timestamp)","event LiquidityAdded(address indexed provider, uint256 amount)","event LiquidityRemoved(address indexed provider, uint256 amount)","event ContractSettled(uint256 settlementPrice)","event PayoutClaimed(address indexed trader, uint256 amount)"]},7267:(e,t,n)=>{n.d(t,{Y:()=>g});var i=n(5155),r=n(3998),a=n(1480),s=n(1851),o=n(2593),l=n(8770),d=n(6874),u=n(9784),c=n(9201),m=n(4972),p=n(6767),x=n(2619),f=n.n(x);function g(e){let{address:t,gasPrice:n,state:x,onConnect:g,connectionError:h}=e,v=n?Number(n.price):0,w=x?Number(x.strikePriceGwei):0,b=!!x&&Number(x.expiryTimestamp)<=Math.floor(Date.now()/1e3);return(0,i.jsxs)("header",{className:"h-16 bg-[#0a0a0a]/90 border-b border-white/5 flex items-center px-4 justify-between shrink-0 z-50 backdrop-blur-md sticky top-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-8",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3 pr-6 border-r border-white/10",children:[(0,i.jsx)("div",{className:"p-2 bg-gradient-to-tr from-orange-500 to-red-600 rounded-lg shadow-[0_0_15px_rgba(239,68,68,0.4)]",children:(0,i.jsx)(a.A,{size:20,className:"text-white fill-white/20"})}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("div",{className:"flex items-center gap-1.5",children:(0,i.jsx)("h1",{className:"font-bold text-lg tracking-tight text-white leading-none uppercase",children:"GASCAP"})}),(0,i.jsx)("span",{className:"text-[10px] text-primary font-bold uppercase tracking-widest leading-none mt-1",children:"Gas Futures Exchange"})]})]}),(0,i.jsxs)("div",{className:"hidden xl:flex items-center gap-10 font-code",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase flex items-center gap-1 mb-0.5",children:[(0,i.jsx)(s.A,{size:10,className:v>0?"text-emerald-500":"text-red-500"}),v>0?"Live Gas Price (FTSO)":"Awaiting FTSO Feed"]}),(0,i.jsxs)("span",{className:"text-lg font-bold leading-none ".concat(v>0?"text-emerald-400 drop-shadow-[0_0_8px_rgba(52,211,153,0.5)]":"text-muted-foreground"),children:[v>0?v.toFixed(2):"---"," ",(0,i.jsx)("span",{className:"text-[10px] text-emerald-600 font-normal uppercase",children:"Gwei"})]})]}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase mb-0.5",children:"Strike Price"}),(0,i.jsxs)("span",{className:"text-white font-medium text-sm leading-none",children:[w>0?w.toString():"---"," ",(0,i.jsx)("span",{className:"text-[10px] text-muted-foreground uppercase",children:"Gwei"})]})]}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase mb-0.5",children:"Pool Liquidity"}),(0,i.jsxs)("span",{className:"text-white font-medium text-sm leading-none",children:[x?(Number(x.totalLiquidityWei)/1e18).toFixed(4):"---"," ",(0,i.jsx)("span",{className:"text-[10px] text-muted-foreground uppercase",children:"C2FLR"})]})]}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsxs)("span",{className:"text-[9px] text-muted-foreground font-bold uppercase mb-0.5 flex items-center gap-1",children:[(0,i.jsx)(o.A,{size:10})," ",(null==x?void 0:x.isSettled)?"Settled":"Expiry"]}),(0,i.jsx)("div",{className:"flex items-center gap-2 text-xs font-bold leading-none",children:(0,i.jsx)("span",{className:(null==x?void 0:x.isSettled)?"text-emerald-400":b?"text-red-400":"text-orange-400",children:(null==x?void 0:x.isSettled)?"SETTLED":(()=>{if(!x)return"--:--:--";let e=Math.floor(Date.now()/1e3),t=Number(x.expiryTimestamp)-e;if(t<=0)return"EXPIRED";let n=Math.floor(t/3600),i=Math.floor(t%3600/60);return"".concat(n.toString().padStart(2,"0"),":").concat(i.toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))})()})})]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[h&&(0,i.jsx)(p.Bc,{children:(0,i.jsxs)(p.m_,{children:[(0,i.jsx)(p.k$,{children:(0,i.jsx)(l.A,{className:"w-4 h-4 text-red-400 animate-pulse"})}),(0,i.jsx)(p.ZI,{className:"bg-red-900/90 border-red-500/30 text-red-100 text-[10px] max-w-[250px]",children:h})]})}),(0,i.jsxs)("nav",{className:"hidden lg:flex items-center gap-4 mr-6",children:[(0,i.jsxs)(f(),{href:"/liquidity",className:"text-[10px] font-bold text-muted-foreground hover:text-primary flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,i.jsx)(d.A,{className:"w-3.5 h-3.5"})," Pool"]}),(0,i.jsxs)(f(),{href:"/settle",className:"text-[10px] font-bold text-muted-foreground hover:text-primary flex items-center gap-1 uppercase tracking-wider transition-colors",children:[(0,i.jsx)(u.A,{className:"w-3.5 h-3.5"})," Settle"]})]}),(0,i.jsxs)("div",{className:"hidden lg:flex items-center gap-2 px-3 py-1.5 bg-blue-500/10 border border-blue-500/20 rounded-full text-[10px] text-blue-400 font-bold uppercase tracking-tight",children:[(0,i.jsx)(c.A,{className:"w-3.5 h-3.5"})," Coston2"]}),(0,i.jsx)(r.$,{variant:"outline",size:"sm",onClick:g,className:"border-white/10 bg-white/5 hover:bg-white/10 font-code text-[11px] h-9 px-4 gap-2 rounded-sm transition-all",children:t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"}),t.slice(0,4),"...",t.slice(-4)]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.A,{className:"w-4 h-4"})," CONNECT"]})})]})]})}}}]);